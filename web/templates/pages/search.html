<!--
CSD-460 Capstone Blue Team
Moffat Bay Lodge Project
Vee Bell, Deja Faison, Julia Gonzalez, Jess Monnier
Professor Sue Sampson
Developed October thru December of 2025
-->

{% extends "pages/base.html" %}

{% block title %}Reservation Search | Moffat Bay Lodge{% endblock %}

{% block content %}

<h2>Reservation Search</h2>

{% if lookup_error %}
  <p style="color: darkred; font-weight: bold; margin-top: 10px;">
    {{ lookup_error }}
  </p>
{% endif %}

<div style="display: flex; gap: 40px; flex-wrap: wrap; margin-top: 20px;">

  <!-- Option A: Search by Email -->
  <div style="flex: 1 1 260px; border: 1px solid #ccc; padding: 15px; border-radius: 6px;">
    <h3>Search by Email</h3>
    <p>Find all reservations associated with your account email.</p>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="search_type" value="email">

      <p>
        <label for="email"><strong>Email address:</strong></label><br>
        <input type="email"
               id="email"
               name="email"
               value="{{ form_email|default:request.user.email }}"
               required
               style="width: 100%;">
      </p>

      <button type="submit">Search by Email</button>
    </form>
  </div>

  <!-- Option B: Search by Name -->
  <div style="flex: 1 1 260px; border: 1px solid #ccc; padding: 15px; border-radius: 6px;">
    <h3>Search by Name</h3>
    <p>Search your reservations using your first and/or last name.</p>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="search_type" value="name">

      <p>
        <label for="first_name"><strong>First name:</strong></label><br>
        <input type="text"
               id="first_name"
               name="first_name"
               value="{{ form_first_name }}"
               style="width: 100%;">
      </p>

      <p>
        <label for="last_name"><strong>Last name:</strong></label><br>
        <input type="text"
               id="last_name"
               name="last_name"
               value="{{ form_last_name }}"
               style="width: 100%;">
      </p>

      <button type="submit">Search by Name</button>
    </form>
  </div>

<!-- Option C: Search by Reservation ID -->
<div style="flex: 1 1 260px; border: 1px solid #ccc; padding: 15px; border-radius: 6px;">
    <h3>Search by Reservation ID</h3>
    <p>Enter your reservation ID to quickly find a reservation.</p>

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="search_type" value="reservation_id">

        <p>
            <label for="reservation_id"><strong>Reservation ID:</strong></label><br>
            <input type="text" id="reservation_id" name="reservation_id"
                   value="{{ form_reservation_id }}" style="width: 100%;" required>
        </p>

        <button type="submit">Search by Reservation ID</button>
    </form>
</div>


</div>

{% if results %}
  <hr style="margin-top: 30px;">
  <h3>Your Reservations</h3>

  <table border="1" cellpadding="6" cellspacing="0">
      <thead>
          <tr>
              <th>Reservation #</th>
              <th>Guest Name</th>
              <th>Room Type</th>
              <th>Check-in</th>
              <th>Check-out</th>
              <th>Guests</th>
              <th>Total Cost</th>
          </tr>
      </thead>
      <tbody>
          {% for r in results %}
              <tr>
                  <td><a href="{% url 'reservation_detail' r.public_id %}">{{ r.public_id }}</a></td>
                  <td>{{ r.guest_first_name }} {{ r.guest_last_name }}</td>
                  <td>{{ r.room_type.name }}</td>
                  <td>{{ r.start_date }}</td>
                  <td>{{ r.end_date }}</td>
                  <td>{{ r.guests }}</td>
                  <td>${{ r.total_cost }}</td>
              </tr>
          {% endfor %}
      </tbody>
  </table>
{% endif %}

{% endblock %}
