{% extends 'pages/base.html' %}

{% block title %}Reservation Summary | Moffat Bay Lodge{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto; padding: 20px; border: 1px solid #ccc;
            border-radius: 8px; background-color: #fafafa;">

  {# Invalid email warnings #}
  {% if invalid_emails %}
    <div style="border: 1px solid #b00020; background-color: #ffe5e8;
                padding: 10px 15px; margin-bottom: 20px; color: #7a0014;">
      <strong>The following email address(es) were not valid and did not receive a confirmation:</strong>
      <ul style="margin: 5px 0 0 18px;">
        {% for e in invalid_emails %}
          <li>{{ e }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <h2 style="margin-top: 0;">Reservation Summary</h2>
  {% if is_hold %}
    <div style="padding: 8px 12px; background-color: #fff3cd; border: 1px solid #ffeeba;
                color: #856404; border-radius: 4px; margin-bottom: 15px;">
      <strong>Status:</strong> Reservation On Hold  
      <br>
      <span style="font-size: 0.9rem;">
        Payment or confirmation is still required. Your room is not fully secured yet.
      </span>
    </div>
  {% else %}
    <div style="padding: 8px 12px; background-color: #d4edda; border: 1px solid #c3e6cb;
                color: #155724; border-radius: 4px; margin-bottom: 15px;">
      <strong>Status:</strong> Reservation Confirmed
    </div>
  {% endif %}
  <p>Thank you, {{ first_name }} {{ last_name }}. Please review your reservation details below:</p>

  <hr />
    
  <section style="margin-bottom: 16px;">
    <h3 style="margin-bottom: 4px;">Reservation Number</h3>
     <p><strong>{{ reservation.id }}</strong></p>
  </section>

  <section style="margin-bottom: 16px;">
  <h3 style="margin-bottom: 4px;">Guest Information</h3>
  <ul style="list-style: none; padding-left: 0;">
    <li><strong>Name:</strong> {{ reservation.guest_first_name }} {{ reservation.guest_last_name }}</li>
    <li><strong>Email:</strong> {{ reservation.guest_email }}</li>
    <li><strong>Phone:</strong> {{ reservation.guest_phone }}</li>
  </ul>
  </section>

  <section style="margin-bottom: 16px;">
  <h3 style="margin-bottom: 4px;">Stay Details</h3>
  <ul style="list-style: none; padding-left: 0;">
    <li><strong>Check-in:</strong> {{ reservation.start_date }}</li>
    <li><strong>Check-out:</strong> {{ reservation.end_date }}</li>
    <li><strong>Number of Guests:</strong> {{ reservation.guests }}</li>
    <li><strong>Room Type:</strong> {{ reservation.room_type.name }}</li>
  </ul>
  </section>

  <section style="margin-bottom: 16px;">
    <h3 style="margin-bottom: 4px;">Pricing Details</h3>

    {% if price_per_night is not None %}
      <ul style="list-style: none; padding-left: 0;">
        <li><strong>Price per night:</strong> ${{ price_per_night|floatformat:2 }}</li>
        {% if nights %}
          <li><strong>Nights:</strong> {{ nights }}</li>
        {% endif %}
        {% if total_cost %}
          <li style="margin-top: 6px;">
            <strong>Total Cost:</strong>
            <span style="font-size: 1.1rem;">${{ total_cost|floatformat:2 }}</span>
          </li>
        {% endif %}
      </ul>
    {% else %}
      <p style="color: red;">Rate information not found for this room type.</p>
    {% endif %}
  </section>

  {% if special_requests %}
    <section style="margin-bottom: 16px;">
      <h3 style="margin-bottom: 4px;">Special Requests</h3>
      <p style="white-space: pre-line;">{{ special_requests }}</p>
    </section>
  {% endif %}

  <hr />

  <div style="display: flex; gap: 10px; margin-top: 10px;">
    <form method="get" action="{% url 'reservation' %}">
      <button type="submit">Edit / Update Reservation</button>
    </form>

    <a href="{% url 'index' %}" style="align-self: center; text-decoration: none;">
      Back to Home
    </a>
  </div>

{% if is_hold %}
  <p style="margin-top: 15px; font-size: 0.9rem; color: #555;">
    Your reservation is currently <strong>on hold</strong>.  
    Please complete any required steps to finalize your booking.
  </p>
{% else %}
  <p style="margin-top: 15px; font-size: 0.9rem; color: #555;">
    Your reservation is <strong>confirmed</strong>.  
    A confirmation email has been sent to the address(es) you provided.
  </p>
{% endif %}

</div>
{% endblock %}
